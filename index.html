<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>StoryVision AI v0.81</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050815;
      color: #f5f5ff;
    }

    a { color: inherit; text-decoration: none; }

    header {
      padding: 16px 20px;
      background: linear-gradient(90deg, #0c1024, #151b3a);
      border-bottom: 1px solid #232a4c;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 8px;
    }

    header .title { display: flex; flex-direction: column; gap: 2px; }

    header h1 {
      font-size: 20px;
      margin: 0;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    header .subtitle { font-size: 12px; color: #a6a9d4; }

    main { display: flex; flex-direction: column; gap: 32px; }

    section { padding: 24px 20px 32px; }

    .stripe-1 {
      background: radial-gradient(circle at top left, #181f3f 0, #050815 55%);
      border-bottom: 1px solid #1c2342;
    }

    .stripe-2 {
      background: radial-gradient(circle at top right, #151f3c 0, #050815 70%);
      border-top: 1px solid #11162f;
    }

    .section-inner { max-width: 960px; margin: 0 auto; }

    .section-header { display: flex; flex-direction: column; gap: 4px; margin-bottom: 16px; }

    .section-title { font-size: 18px; display: flex; align-items: center; gap: 8px; }

    .section-title span.badge {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #252c55;
      border: 1px solid #3a4584;
      color: #c7d1ff;
    }

    .section-desc { font-size: 13px; color: #a8add6; }

    textarea {
      width: 100%;
      min-height: 220px;
      resize: vertical;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #313a69;
      background: #070a18;
      color: #f5f5ff;
      font-family: inherit;
      font-size: 14px;
      line-height: 1.5;
    }

    textarea::placeholder { color: #696f9c; }

    .label { font-size: 13px; color: #c4c7ec; margin-bottom: 6px; }

    .helper { font-size: 11px; color: #868bbb; margin-top: 4px; }

    .btn {
      font-family: inherit;
      font-size: 14px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid #3943a6;
      background: #2a3389;
      color: #f5f5ff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s, transform 0.05s, opacity 0.15s;
      white-space: nowrap;
    }

    .btn span.icon { font-size: 15px; }

    .btn:hover:not(:disabled) { background: #3c47c0; }

    .btn:active:not(:disabled) { transform: translateY(1px); }

    .btn:disabled { opacity: 0.45; cursor: not-allowed; }

    .btn-secondary { background: #161a34; border-color: #3a405f; }
    .btn-secondary:hover:not(:disabled) { background: #202640; }

    .btn-green { background: #1f6f46; border-color: #28a567; }
    .btn-green:hover:not(:disabled) { background: #2a9a63; }

    .btn-grey { background: #272b3c; border-color: #3e4256; }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-top: 12px;
    }

    .progress-wrapper { margin-top: 16px; }

    .progress-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #9aa1d4;
      margin-bottom: 4px;
    }

    .progress-bar-outer {
      position: relative;
      width: 100%;
      height: 14px;
      border-radius: 999px;
      background: #15182b;
      overflow: hidden;
      border: 1px solid #272d4f;
    }

    .progress-bar-inner {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #b32b39, #f55c4a);
      transition: width 0.1s linear, background 0.2s;
    }

    .progress-bar-inner.done { background: linear-gradient(90deg, #2e9f5d, #5be48f); }

    .progress-percentage {
      font-size: 11px;
      color: #d1d7ff;
      margin-top: 4px;
      text-align: right;
    }

    .hidden { display: none; }

    .card {
      border-radius: 10px;
      border: 1px solid #252c4c;
      background: rgba(7, 10, 25, 0.9);
      padding: 14px 16px;
      margin-top: 8px;
    }

    .scene-list {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 420px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .scene-item {
      display: grid;
      grid-template-columns: 72px minmax(0, 1.6fr) minmax(0, 1.3fr) auto;
      gap: 10px;
      padding: 8px;
      border-radius: 8px;
      background: #090d22;
      border: 1px solid #252c4c;
      align-items: center;
    }

    @media (max-width: 900px) {
      .scene-item {
        grid-template-columns: 72px minmax(0, 1fr);
        grid-template-rows: auto auto auto;
      }
      .scene-item > .scene-prompt { grid-column: 1 / span 2; }
      .scene-item > .scene-actions { grid-column: 1 / span 2; }
    }

    .thumb {
      width: 72px;
      height: 48px;
      border-radius: 6px;
      background: radial-gradient(circle at 20% 20%, #ffffff33 0, #38408a 25%, #14162f 55%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: #dde2ff;
      position: relative;
      overflow: hidden;
    }

    .thumb::after {
      content: "";
      position: absolute;
      width: 85%;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, #ffffff55, transparent);
      transform: rotate(-28deg);
      top: 10%;
      left: -30%;
    }

    .scene-text { font-size: 13px; color: #e3e6ff; }
    .scene-text small { display: block; font-size: 11px; color: #8e94c1; margin-top: 3px; }

    .scene-prompt { font-size: 12px; color: #b8bff3; }
    .scene-prompt-label { font-size: 11px; color: #8e94c1; margin-bottom: 2px; }
    .scene-prompt-content { font-size: 12px; color: #d4d8ff; }

    .scene-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      font-size: 11px;
      color: #9aa1d4;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #38406b;
      background: #10152d;
      font-size: 11px;
      color: #c0c6ff;
    }

    .pill.ready { border-color: #2c8f57; background: #14291f; color: #bfeecf; }
    .pill.pending { border-color: #91502e; background: #26150f; color: #ffd7b3; }
    .pill.processing { border-color: #3a6fb4; background: #0f1c2a; color: #c8e3ff; }
    .pill.error { border-color: #c84a4a; background: #2a0f14; color: #ffd0d0; }

    footer {
      padding: 12px 20px 20px;
      border-top: 1px solid #101632;
      font-size: 11px;
      color: #7f85b4;
      text-align: center;
    }

    .meta-table {
      width: 100%;
      margin-top: 8px;
      border-collapse: collapse;
      border: 1px solid #252c4c;
      background: rgba(7, 10, 25, 0.45);
      border-radius: 8px;
      overflow: hidden;
    }
    .meta-table th,
    .meta-table td {
      padding: 6px 8px;
      border-bottom: 1px solid #1f2542;
      font-size: 11px;
      vertical-align: top;
    }
    .meta-table th {
      width: 120px;
      text-align: left;
      color: #8e94c1;
      background: rgba(16, 21, 45, 0.65);
      border-right: 1px solid #1f2542;
      font-weight: 600;
    }
    .meta-table td {
      color: #d4d8ff;
      word-break: break-word;
      white-space: pre-wrap;
    }
    .meta-table tr:last-child th,
    .meta-table tr:last-child td { border-bottom: none; }
  </style>
</head>

<body>
<header>
  <div class="title">
    <h1>StoryVision AI</h1>
    <div class="subtitle">ë¬¸ì¥ ê¸°ë°˜ ì˜ìƒ ìë™í™” ìƒì„± í”„ë¡œê·¸ë¨</div>
  </div>
</header>

<main>
  <!-- ìŠ¤íŠ¸ë© 1 -->
  <section class="stripe-1">
    <div class="section-inner">
      <div class="section-header">
        <div class="section-title">
          <span>ìŠ¤íŠ¸ë© 1 Â· í”„ë¡¬í”„íŠ¸ ìƒì„±</span><span class="badge">STEP 1</span>
        </div>
        <div class="section-desc">
          ì¤„ ë‹¨ìœ„ë¡œ ì…ë ¥ëœ í…ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì¤„ë‹¹ 1ê°œì˜ ì˜ìƒ í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
        </div>
      </div>

      <div class="card">
        <div class="label">ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>
        <textarea id="inputText" placeholder="ì²« ì¤„ = ì²« ì¥ë©´"></textarea>

        <div class="row">
          <button id="generatePromptsBtn" class="btn">
            <span class="icon">âœ¨</span>í”„ë¡¬í”„íŠ¸ ìƒì„±í•˜ê¸°
          </button>
          <span class="helper">â€»ë¹„ë°€ë²ˆí˜¸ í•„ìš”</span>
        </div>

        <div id="promptProgressWrapper" class="progress-wrapper hidden">
          <div class="progress-label-row">
            <span>í”„ë¡¬í”„íŠ¸ ìƒì„± ì§„í–‰ë„</span>
            <span id="promptStatusText">ëŒ€ê¸° ì¤‘â€¦</span>
          </div>
          <div class="progress-bar-outer">
            <div id="promptProgressBar" class="progress-bar-inner"></div>
          </div>
          <div id="promptProgressPercent" class="progress-percentage">0%</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ìŠ¤íŠ¸ë© 2 -->
  <section class="stripe-2">
    <div class="section-inner">
      <div class="section-header">
        <div class="section-title">
          <span>ìŠ¤íŠ¸ë© 2 Â· ì˜ìƒ ìƒì„± ê´€ë¦¬</span>
          <span class="badge">STEP 2</span>
        </div>
        <div class="section-desc">
          ìƒì„±ëœ ë¬¸ì¥ + í”„ë¡¬í”„íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ì˜ìƒ ìƒì„± ìƒíƒœë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
        </div>
      </div>

      <div class="card">
        <div class="row" style="justify-content: space-between;">
          <div class="helper">ë¨¼ì € í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.</div>

          <button id="generateVideosBtn" class="btn btn-secondary">
            <span class="icon">ğŸ¬</span>ì˜ìƒ ìƒì„±í•˜ê¸°
          </button>
        </div>

        <div id="videoProgressWrapper" class="progress-wrapper hidden">
          <div class="progress-label-row">
            <span>ì˜ìƒ ìƒì„±</span>
            <span id="videoStatusText">ëŒ€ê¸° ì¤‘â€¦</span>
          </div>
          <div class="progress-bar-outer">
            <div id="videoProgressBar" class="progress-bar-inner"></div>
          </div>
          <div id="videoProgressPercent" class="progress-percentage">0%</div>
        </div>

        <div class="row" style="justify-content: flex-end; margin-top:16px;">
          <button id="downloadAllBtn" class="btn btn-grey" disabled>
            <span class="icon">ğŸ“¦</span>ì¼ê´„ ë‹¤ìš´ë¡œë“œ
          </button>
        </div>

        <div id="sceneList" class="scene-list"></div>
      </div>
    </div>
  </section>
</main>

<footer>StoryVision AI Â· MVP</footer>

<script>
/* -----------------------------
   ê¸°ë³¸ ì„¤ì • / ìƒíƒœ ë³€ìˆ˜
------------------------------ */
const API_BASE = "https://storyvision-backend.onrender.com";

let segments = [];
let promptGenerationInProgress = false;
let videoGenerationInProgress = false;
const PASSWORD = "9981";

const $ = id => document.getElementById(id);

/* DOM ìš”ì†Œ */
const inputTextEl = $("inputText");
const generatePromptsBtn = $("generatePromptsBtn");
const promptProgressWrapper = $("promptProgressWrapper");
const promptProgressBar = $("promptProgressBar");
const promptProgressPercent = $("promptProgressPercent");
const promptStatusText = $("promptStatusText");

const generateVideosBtn = $("generateVideosBtn");
const videoProgressWrapper = $("videoProgressWrapper");
const videoProgressBar = $("videoProgressBar");
const videoProgressPercent = $("videoProgressPercent");
const videoStatusText = $("videoStatusText");
const downloadAllBtn = $("downloadAllBtn");
const sceneListEl = $("sceneList");

/* ë¹„ë°€ë²ˆí˜¸ í™•ì¸ */
function checkPassword() {
  const answer = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
  if (answer === null) return false;
  if (answer.trim() !== PASSWORD) {
    alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    return false;
  }
  return true;
}

/* -----------------------------
   1) í”„ë¡¬í”„íŠ¸ ìƒì„± ìš”ì²­
------------------------------ */
generatePromptsBtn.addEventListener("click", () => {
  if (promptGenerationInProgress || videoGenerationInProgress) return alert("ì‘ì—… ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.");
  if (!checkPassword()) return;

  const lines = inputTextEl.value.split("\n").map(s => s.trim()).filter(s => s);
  if (lines.length === 0) return alert("ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”.");

  segments = lines.map((line, idx) => ({
    id: idx + 1,
    lineKo: line,
    promptEn: "",

    // video ìƒíƒœ
    videoStatus: "pending", // pending|processing|ready|error
    videoUrl: null,

    // video job id
    _videoJobId: null,

    // ë©”íƒ€ í‘œì‹œ
    duration: null,
    resolution: null,
    model: null,
    originalPrompt: null,

    // ì˜¤ë¥˜ ë©”ì‹œì§€
    error: null
  }));

  renderSceneList();
  requestPromptGeneration(lines);
});

/* ì„œë²„ë¡œ í”„ë¡¬í”„íŠ¸ ìƒì„± ìš”ì²­
   - ë„ˆ ë°±ì—”ë“œê°€ /generate-prompts ë¡œ {lines:[...]} -> {items:[{id, prompt_en}]} í˜•íƒœì˜€ë˜ ê±¸ ê·¸ëŒ€ë¡œ ì‚¬ìš©
*/
function requestPromptGeneration(lines) {
  promptGenerationInProgress = true;
  generatePromptsBtn.disabled = true;
  generateVideosBtn.disabled = true;

  promptProgressWrapper.classList.remove("hidden");
  promptProgressBar.classList.remove("done");
  promptProgressBar.style.width = "0%";
  promptProgressPercent.textContent = "0%";
  promptStatusText.textContent = "ì„œë²„ ìš”ì²­ ì¤‘â€¦";

  fetch(`${API_BASE}/generate-prompts`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ lines })
  })
  .then(res => res.json())
  .then(json => {
    const items = Array.isArray(json.items) ? json.items : [];
    items.forEach(item => {
      const seg = segments.find(s => s.id === item.id);
      if (seg) seg.promptEn = item.prompt_en || "";
    });

    promptProgressBar.style.width = "100%";
    promptProgressPercent.textContent = "100%";
    promptProgressBar.classList.add("done");
    promptStatusText.textContent = "í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ!";

    promptGenerationInProgress = false;
    generatePromptsBtn.disabled = false;
    generateVideosBtn.disabled = false;

    renderSceneList();
  })
  .catch(err => {
    alert("ì„œë²„ ì˜¤ë¥˜: " + err.message);
    promptGenerationInProgress = false;
    generatePromptsBtn.disabled = false;
    generateVideosBtn.disabled = false;
  });
}

/* -----------------------------
   2) ì˜ìƒ ìƒì„± (ì‹¤ì œ ì„œë²„ /video-jobs ì‚¬ìš©)
------------------------------ */
generateVideosBtn.addEventListener("click", async () => {
  if (promptGenerationInProgress || videoGenerationInProgress) return alert("ì‘ì—… ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.");
  if (!checkPassword()) return;

  if (segments.length === 0) return alert("ë¨¼ì € í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.");
  if (segments.some(s => !s.promptEn)) return alert("ì•„ì§ í”„ë¡¬í”„íŠ¸ê°€ ìƒì„±ë˜ì§€ ì•Šì€ ë¬¸ì¥ì´ ìˆìŠµë‹ˆë‹¤.");

  try {
    await startVideoGenerationReal();
  } catch (e) {
    alert("ì˜ìƒ ìƒì„± ì˜¤ë¥˜: " + e.message);
    videoGenerationInProgress = false;
    generateVideosBtn.disabled = false;
    generatePromptsBtn.disabled = false;
  }
});

async function createVideoJob(promptEn) {
  const res = await fetch(`${API_BASE}/video-jobs`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      prompt: promptEn,
      model: "MiniMax-Hailuo-2.3",
      duration: 6,
      resolution: "768P",
      prompt_optimizer: true,
      fast_pretreatment: false
    })
  });

  const json = await res.json().catch(() => ({}));
  if (!res.ok) throw new Error(json.detail || `createVideoJob failed: ${res.status}`);
  return json; // { job_id, status, minimax_task_id }
}

async function getVideoJob(jobId) {
  const res = await fetch(`${API_BASE}/video-jobs/${jobId}`);
  const json = await res.json().catch(() => ({}));
  if (!res.ok) throw new Error(json.detail || `getVideoJob failed: ${res.status}`);
  return json;
}

function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

async function runWithConcurrency(items, worker, concurrency=3) {
  const queue = items.slice();
  const workers = Array.from({length: concurrency}, async () => {
    while (queue.length) {
      const item = queue.shift();
      await worker(item);
    }
  });
  await Promise.all(workers);
}

async function startVideoGenerationReal() {
  videoGenerationInProgress = true;

  generateVideosBtn.disabled = true;
  generatePromptsBtn.disabled = true;
  downloadAllBtn.disabled = true;

  videoProgressWrapper.classList.remove("hidden");
  videoProgressBar.classList.remove("done");
  videoProgressBar.style.width = "0%";
  videoProgressPercent.textContent = "0%";
  videoStatusText.textContent = "ì˜ìƒ ìƒì„± ì‘ì—… ìƒì„± ì¤‘â€¦";

  // 1) ê° ì„¸ê·¸ë¨¼íŠ¸ì— video job ìƒì„± (ë™ì‹œ 3ê°œ)
  await runWithConcurrency(
    segments,
    async (seg) => {
      seg.videoStatus = "processing";
      seg.videoUrl = null;
      seg.error = null;
      renderSceneList();

      const created = await createVideoJob(seg.promptEn);
      seg._videoJobId = created.job_id;
      renderSceneList();
    },
    3
  );

  // 2) í´ë§: DONE/ERROR ë  ë•Œê¹Œì§€ ë°˜ë³µ
  const total = segments.length;

  while (true) {
    let finished = 0;

    for (const seg of segments) {
      if (!seg._videoJobId) continue;

      if (seg.videoStatus === "ready" || seg.videoStatus === "error") {
        finished++;
        continue;
      }

      const st = await getVideoJob(seg._videoJobId);

      // ë©”íƒ€ ê°±ì‹ 
      seg.duration = st.duration ?? seg.duration ?? "-";
      seg.resolution = st.resolution ?? seg.resolution ?? "-";
      seg.model = st.model ?? seg.model ?? "-";
      seg.originalPrompt = st.prompt ?? seg.originalPrompt ?? seg.promptEn;

      if (st.status === "DONE") {
        seg.videoStatus = "ready";
        seg.videoUrl = st.download_url || null;   // âœ… ì§„ì§œ URL
        if (!seg.videoUrl) {
          // DONEì¸ë° urlì´ ì—†ëŠ” ì¼€ì´ìŠ¤(íŒŒì¼ retrieve ì‹¤íŒ¨ ë“±)
          seg.videoStatus = "error";
          seg.error = "DONE but download_url is missing";
        }
      } else if (st.status === "ERROR") {
        seg.videoStatus = "error";
        seg.videoUrl = null;
        seg.error = st.error || "Unknown error";
      } else {
        seg.videoStatus = "processing";
      }
    }

    renderSceneList();

    const pct = Math.floor((finished / total) * 100);
    videoProgressBar.style.width = `${pct}%`;
    videoProgressPercent.textContent = `${pct}%`;
    videoStatusText.textContent = `ì˜ìƒ ìƒì„± ì¤‘â€¦ (${finished}/${total})`;

    if (finished >= total) break;
    await sleep(1500);
  }

  videoGenerationInProgress = false;
  videoProgressBar.classList.add("done");
  videoStatusText.textContent = "ì˜ìƒ ìƒì„± ì™„ë£Œ!";
  downloadAllBtn.disabled = false;
  generateVideosBtn.disabled = false;
  generatePromptsBtn.disabled = false;
}

/* -----------------------------
   Scene ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
------------------------------ */
function renderSceneList() {
  sceneListEl.innerHTML = "";

  if (segments.length === 0) {
    const empty = document.createElement("div");
    empty.className = "helper";
    empty.textContent = "ì•„ì§ í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.";
    sceneListEl.appendChild(empty);
    return;
  }

  segments.forEach(seg => {
    const item = document.createElement("div");
    item.className = "scene-item";

    const thumb = document.createElement("div");
    thumb.className = "thumb";
    thumb.textContent = "â–¶";

    const textBlock = document.createElement("div");
    textBlock.className = "scene-text";
    textBlock.innerHTML = `
      ë¬¸ì¥ ${seg.id}
      <small>${seg.lineKo}</small>
    `;

    const promptBlock = document.createElement("div");
    promptBlock.className = "scene-prompt";

    const errLine = seg.error ? `<div style="margin-top:6px;color:#ffb3b3;font-size:11px;">âš  ${seg.error}</div>` : "";

    promptBlock.innerHTML = `
      <div class="scene-prompt-label">ì˜ë¬¸ í”„ë¡¬í”„íŠ¸</div>
      <div class="scene-prompt-content">
        ${seg.promptEn || "(ë¯¸ìƒì„±)"}
      </div>

      <table class="meta-table">
        <tr>
          <th>duration</th>
          <td>${seg.duration ?? "-"}</td>
        </tr>
        <tr>
          <th>resolution</th>
          <td>${seg.resolution ?? "-"}</td>
        </tr>
        <tr>
          <th>model</th>
          <td>${seg.model ?? "-"}</td>
        </tr>
        <tr>
          <th>original prompt</th>
          <td>${seg.originalPrompt ?? "-"}</td>
        </tr>
      </table>
      ${errLine}
    `;

    const actions = document.createElement("div");
    actions.className = "scene-actions";

    const pill = document.createElement("span");
    if (seg.videoStatus === "ready") {
      pill.className = "pill ready";
      pill.textContent = "ìƒì„± ì™„ë£Œ";
    } else if (seg.videoStatus === "processing") {
      pill.className = "pill processing";
      pill.textContent = "ìƒì„± ì¤‘";
    } else if (seg.videoStatus === "error") {
      pill.className = "pill error";
      pill.textContent = "ì‹¤íŒ¨";
    } else {
      pill.className = "pill pending";
      pill.textContent = "ëŒ€ê¸° ì¤‘";
    }

    const dlBtn = document.createElement("button");
    dlBtn.className = "btn " + (seg.videoStatus === "ready" ? "btn-green" : "btn-grey");
    dlBtn.style.padding = "4px 10px";
    dlBtn.textContent = "ë‹¤ìš´ë¡œë“œ";
    dlBtn.disabled = !(seg.videoStatus === "ready" && seg.videoUrl);

    if (seg.videoStatus === "ready" && seg.videoUrl) {
      dlBtn.onclick = () => window.open(seg.videoUrl, "_blank");
    }

    actions.appendChild(pill);
    actions.appendChild(dlBtn);

    item.appendChild(thumb);
    item.appendChild(textBlock);
    item.appendChild(promptBlock);
    item.appendChild(actions);

    sceneListEl.appendChild(item);
  });
}

/* -----------------------------
   ì´ˆê¸° ë Œë”
------------------------------ */
renderSceneList();
</script>

</body>
</html>
