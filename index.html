<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>StoryVision AI - ë¯¸ìŠ¤í„°ë¦¬ ì˜ìƒ ìë™ í”„ë¡¬í”„íŠ¸ & ìƒì„± ê´€ë¦¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;      
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050815;
      color: #f5f5ff;
    }

    header {
      padding: 16px 20px;
      background: linear-gradient(90deg, #0c1024, #151b3a);
      border-bottom: 1px solid #232a4c;
    }

    h1 {
      font-size: 20px;
      margin: 0;
      font-weight: 700;
    }

    textarea {
      width: 100%;
      min-height: 220px;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #313a69;
      background: #070a18;
      color: white;
      resize: vertical;
    }

    .btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid #3943a6;
      background: #2a3389;
      color: white;
      cursor: pointer;
      margin-top: 10px;
    }

    .btn-secondary {
      background: #24283e;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .progress-wrapper {
      margin-top: 10px;
    }

    .progress-bar-outer {
      width: 100%;
      height: 14px;
      background: #15182b;
      border-radius: 999px;
      border: 1px solid #272d4f;
      overflow: hidden;
    }

    .progress-bar-inner {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #b32b39, #f55c4a);
      transition: width 0.1s linear;
    }

    .progress-bar-inner.done {
      background: linear-gradient(90deg, #2e9f5d, #5be48f);
    }

    .scene-list {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .scene-item {
      padding: 12px;
      background: #0a0e21;
      border-radius: 10px;
      border: 1px solid #262c45;
    }

    .scene-prompt {
      margin-top: 6px;
      color: #b8bff3;
      font-size: 13px;
    }

    footer {
      margin-top: 40px;
      padding: 20px;
      font-size: 12px;
      color: #8a8eb8;
      text-align: center;
    }
  </style>
</head>

<body>
  <header>
    <h1>StoryVision AI</h1>
    <div>ê¸°ë¬˜í•œ ë°¤ ìŠ¤íƒ€ì¼ Â· í…ìŠ¤íŠ¸ â†’ í”„ë¡¬í”„íŠ¸ ë³€í™˜ ìë™í™”</div>
  </header>

  <main style="padding: 20px; max-width: 900px; margin: auto;">

    <section>
      <h2>ìŠ¤íŠ¸ë© 1 Â· í”„ë¡¬í”„íŠ¸ ìƒì„±</h2>

      <textarea id="inputText" placeholder="í•œ ì¤„ë‹¹ í•˜ë‚˜ì˜ ì˜ìƒ í´ë¦½ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤."></textarea>

      <button id="generatePromptsBtn" class="btn">âœ¨ í”„ë¡¬í”„íŠ¸ ìƒì„±</button>

      <div id="promptProgressWrapper" class="progress-wrapper" style="display:none;">
        <div class="progress-bar-outer">
          <div id="promptProgressBar" class="progress-bar-inner"></div>
        </div>
        <div id="promptStatusText" style="font-size:12px; margin-top:4px;">ëŒ€ê¸° ì¤‘â€¦</div>
      </div>

      <div id="sceneList" class="scene-list"></div>
    </section>

  </main>

  <footer>StoryVision AI Â· MVP ë²„ì „ Â· ì‹¤ì œ GPT/ì˜ìƒ APIëŠ” ì°¨í›„ ì—°ë™</footer>

  <script>
    /* ============================
       ğŸ”— ì„œë²„ ì£¼ì†Œ ì„¸íŒ…
    ============================ */
    const API_BASE = "https://storyvision-backend.onrender.com";

    /* ============================
       ì „ì—­ ìƒíƒœ
    ============================ */
    let segments = [];
    const PASSWORD = "9981";

    const inputTextEl = document.getElementById("inputText");
    const generatePromptsBtn = document.getElementById("generatePromptsBtn");

    const promptWrapper = document.getElementById("promptProgressWrapper");
    const promptBar = document.getElementById("promptProgressBar");
    const promptStatus = document.getElementById("promptStatusText");
    const sceneListEl = document.getElementById("sceneList");

    /* ============================
       ë¹„ë°€ë²ˆí˜¸ ê²€ì‚¬
    ============================ */
    function checkPassword() {
      const answer = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (9981)");
      return answer === PASSWORD;
    }

    /* ============================
       í”„ë¡¬í”„íŠ¸ ìƒì„± ë²„íŠ¼
    ============================ */
    generatePromptsBtn.addEventListener("click", () => {
      if (!checkPassword()) return;

      const raw = inputTextEl.value;
      const lines = raw.split("\n").map(x => x.trim()).filter(Boolean);

      if (lines.length === 0) {
        alert("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }

      segments = lines.map((line, idx) => ({
        id: idx + 1,
        lineKo: line,
        promptEn: "",
      }));

      renderSceneList();
      callGeneratePromptsAPI(lines);
    });

    /* ============================
       ë°±ì—”ë“œ í˜¸ì¶œ â†’ í”„ë¡¬í”„íŠ¸ ìƒì„±
    ============================ */
    function callGeneratePromptsAPI(lines) {
      promptWrapper.style.display = "block";
      promptBar.style.width = "0%";
      promptStatus.textContent = "ì„œë²„ì— ìš”ì²­ ì¤‘â€¦";

      fetch(`${API_BASE}/generate-prompts`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ lines }),
      })
        .then(res => res.json())
        .then(data => {
          data.items.forEach(item => {
            const seg = segments.find(s => s.id === item.id);
            if (seg) seg.promptEn = item.prompt_en;
          });

          promptBar.style.width = "100%";
          promptBar.classList.add("done");
          promptStatus.textContent = "í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ!";
          renderSceneList();
        })
        .catch(err => {
          console.error(err);
          alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ: " + err.message);
        });
    }

    /* ============================
       ì¥ë©´ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
    ============================ */
    function renderSceneList() {
      sceneListEl.innerHTML = "";

      if (segments.length === 0) return;

      segments.forEach(seg => {
        const div = document.createElement("div");
        div.className = "scene-item";

        div.innerHTML = `
          <div><strong>ë¬¸ì¥ ${seg.id}</strong></div>
          <div>${seg.lineKo}</div>
          <div class="scene-prompt">
            <strong>í”„ë¡¬í”„íŠ¸:</strong><br>
            ${seg.promptEn || "(ì•„ì§ ìƒì„±ë˜ì§€ ì•ŠìŒ)"}
          </div>
        `;

        sceneListEl.appendChild(div);
      });
    }

  </script>
</body>
</html>
