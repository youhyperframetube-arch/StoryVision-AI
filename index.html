<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>StoryVision AI - ë¯¸ìŠ¤í„°ë¦¬ ì˜ìƒ ìë™ í”„ë¡¬í”„íŠ¸ & ìƒì„± ê´€ë¦¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050815;
      color: #f5f5ff;
    }

    header {
      padding: 16px 20px;
      background: linear-gradient(90deg, #0c1024, #151b3a);
      border-bottom: 1px solid #232a4c;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
    }

    header .subtitle {
      font-size: 12px;
      color: #a6a9d4;
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 32px;
    }

    section {
      padding: 24px 20px 32px;
    }

    .stripe-1 {
      background: radial-gradient(circle at top left, #181f3f 0, #050815 55%);
      border-bottom: 1px solid #1c2342;
    }

    .stripe-2 {
      background: radial-gradient(circle at top right, #151f3c 0, #050815 70%);
      border-top: 1px solid #11162f;
    }

    .section-inner {
      max-width: 960px;
      margin: 0 auto;
    }

    .section-title {
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #252c55;
      border: 1px solid #3a4584;
      color: #c7d1ff;
    }

    textarea {
      width: 100%;
      min-height: 220px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #313a69;
      background: #070a18;
      color: #fff;
    }

    .btn {
      padding: 8px 14px;
      border-radius: 999px;
      background: #2a3389;
      border: 1px solid #3943a6;
      color: #fff;
      cursor: pointer;
    }
    .btn-secondary { background: #161a34; border-color:#3a405f; }
    .btn-green { background:#1f6f46; border-color:#28a567; }
    .btn-orange { background:#7a3f13; border-color:#b8641b; }

    .scene-list {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .scene-item {
      display: grid;
      grid-template-columns: 72px minmax(0,1.6fr) minmax(0,1.3fr) auto;
      gap: 10px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #252c4c;
      background: #090d22;
      align-items: flex-start;
    }

    .thumb {
      width: 72px;
      height: 48px;
      border-radius: 6px;
      background: #14162f;
      display: flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
    }

    .pill {
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      font-size:11px;
    }
    .pill.ready { border:1px solid #2c8f57; background:#14291f; color:#bfeecf; }
    .pill.pending { border:1px solid #91502e; background:#26150f; color:#ffd7b3; }

    footer { padding:20px; text-align:center; font-size:11px; color:#7f85b4; }
  </style>
</head>

<body>
<header>
  <h1>StoryVision AI</h1>
  <div class="subtitle">ê¸°ë¬˜í•œ ë°¤ ìŠ¤íƒ€ì¼ ë¯¸ìŠ¤í„°ë¦¬ ì˜ìƒí™”ë¥¼ ìœ„í•œ í…ìŠ¤íŠ¸ â†’ í”„ë¡¬í”„íŠ¸ â†’ ì˜ìƒ ìƒì„± ë„ìš°ë¯¸</div>
</header>

<main>

<!-- ìŠ¤íŠ¸ë© 1 -->
<section class="stripe-1">
  <div class="section-inner">
    <div class="section-title">
      ìŠ¤íŠ¸ë© 1 Â· í”„ë¡¬í”„íŠ¸ ìƒì„± <span class="badge">STEP 1</span>
    </div>

    <textarea id="inputText"></textarea>

    <button id="generatePromptsBtn" class="btn">âœ¨ í”„ë¡¬í”„íŠ¸ ìƒì„±í•˜ê¸°</button>

    <div id="promptProgressWrapper" class="hidden">
      <div id="promptStatusText"></div>
      <div class="progress-bar-outer">
        <div id="promptProgressBar" class="progress-bar-inner"></div>
      </div>
      <div id="promptProgressPercent">0%</div>
    </div>
  </div>
</section>

<!-- ìŠ¤íŠ¸ë© 2 -->
<section class="stripe-2">
  <div class="section-inner">
    <div class="section-title">
      ìŠ¤íŠ¸ë© 2 Â· ì˜ìƒ ìƒì„± ê´€ë¦¬ <span class="badge">STEP 2</span>
    </div>

    <button id="generateVideosBtn" class="btn btn-secondary">ğŸ¬ ì˜ìƒ ìƒì„±í•˜ê¸°</button>

    <div id="videoProgressWrapper" class="hidden">
      <div id="videoStatusText"></div>
      <div class="progress-bar-outer">
        <div id="videoProgressBar" class="progress-bar-inner"></div>
      </div>
      <div id="videoProgressPercent">0%</div>
    </div>

    <div id="sceneList" class="scene-list"></div>

    <button id="downloadAllBtn" class="btn btn-grey" disabled>ğŸ“¦ ì¼ê´„ ë‹¤ìš´ë¡œë“œ</button>
  </div>
</section>

</main>

<footer>StoryVision AI Â· MVP</footer>

<script>
let segments = [];
let promptGenerationInProgress = false;
let videoGenerationInProgress = false;
const PASSWORD = "9981";

const $ = (id) => document.getElementById(id);

/* UI Elements */
const inputTextEl = $("inputText");
const generatePromptsBtn = $("generatePromptsBtn");
const promptProgressWrapper = $("promptProgressWrapper");
const promptProgressBar = $("promptProgressBar");
const promptProgressPercent = $("promptProgressPercent");
const promptStatusText = $("promptStatusText");

const generateVideosBtn = $("generateVideosBtn");
const videoProgressWrapper = $("videoProgressWrapper");
const videoProgressBar = $("videoProgressBar");
const videoProgressPercent = $("videoProgressPercent");
const videoStatusText = $("videoStatusText");

const sceneListEl = $("sceneList");
const downloadAllBtn = $("downloadAllBtn");

function checkPassword() {
  return prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (9981)") === PASSWORD;
}

/* ------------------------------
   STEP 1 â€” í”„ë¡¬í”„íŠ¸ ìƒì„±
------------------------------*/
generatePromptsBtn.addEventListener("click", () => {
  if (!checkPassword()) return;

  const lines = inputTextEl.value.trim().split("\n").map(v=>v.trim()).filter(v=>v);

  segments = lines.map((line, idx) => ({
    id: idx+1,
    lineKo: line,
    promptEn: "",
    videoStatus: "pending",

    // minimax info
    videoUrl: null,
    thumbnailUrl: null,
    duration: null,
    resolution: null,
    model: null,
    version: null,
  }));

  renderSceneList();
  simulatePromptGeneration(lines);
});

function simulatePromptGeneration(lines) {
  promptGenerationInProgress = true;
  generatePromptsBtn.disabled = true;

  promptProgressWrapper.classList.remove("hidden");
  let current = 0;
  const total = lines.length;

  function step() {
    if (current >= total) {
      promptGenerationInProgress = false;
      generatePromptsBtn.disabled = false;
      promptProgressBar.style.width = "100%";
      promptProgressPercent.textContent = "100%";
      promptStatusText.textContent = "í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ!";
      return;
    }

    segments[current].promptEn =
      `Documentary-style cinematic shot for: "${lines[current].slice(0,40)}..." in a dark, mysterious atmosphere`;

    current++;
    let pct = Math.round((current/total)*100);
    promptProgressBar.style.width = pct+"%";
    promptProgressPercent.textContent = pct+"%";
    promptStatusText.textContent = `í”„ë¡¬í”„íŠ¸ ìƒì„± ì¤‘ (${current}/${total})`;

    renderSceneList();
    setTimeout(step, 150);
  }
  step();
}

/* ------------------------------
   STEP 2 â€” ì „ì²´ ì˜ìƒ ìƒì„±
------------------------------*/
generateVideosBtn.addEventListener("click", () => {
  if (!checkPassword()) return;
  simulateFullVideoGeneration();
});

function simulateFullVideoGeneration() {
  videoGenerationInProgress = true;
  generateVideosBtn.disabled = true;

  videoProgressWrapper.classList.remove("hidden");
  let current = 0;
  const total = segments.length;

  function step() {
    if (current >= total) {
      videoGenerationInProgress = false;
      generateVideosBtn.disabled = false;
      downloadAllBtn.disabled = false;

      videoProgressBar.style.width = "100%";
      videoProgressPercent.textContent = "100%";
      videoStatusText.textContent = "ì˜ìƒ ìƒì„± ì™„ë£Œ!";
      return;
    }

    applyFakeVideoData(segments[current]);

    current++;
    let pct = Math.round((current/total)*100);
    videoProgressBar.style.width = pct+"%";
    videoProgressPercent.textContent = pct+"%";
    videoStatusText.textContent = `ì˜ìƒ ìƒì„± ì¤‘ (${current}/${total})`;

    renderSceneList();
    setTimeout(step, 350);
  }

  step();
}

/* ------------------------------
   ğŸ”„ ë‹¨ì¼ ì¬ìƒì„± ê¸°ëŠ¥
------------------------------*/
function regenerateSingleVideo(segId) {
  const seg = segments.find(s => s.id === segId);
  if (!seg) return;

  // ì´ˆê¸°í™”
  seg.videoStatus = "pending";
  seg.videoUrl = null;
  seg.thumbnailUrl = null;
  seg.duration = null;
  seg.resolution = null;
  seg.model = null;
  seg.version = null;

  renderSceneList();

  // ê°œë³„ ë Œë”ë§ ì‹¤í–‰
  startSingleVideoGeneration(seg);
}

function startSingleVideoGeneration(seg) {
  // 0.3ì´ˆ í›„ ê°œë³„ ë Œë” ì™„ë£Œ ì‹œë®¬ë ˆì´ì…˜
  setTimeout(() => {
    applyFakeVideoData(seg);
    renderSceneList();
  }, 600);
}

function applyFakeVideoData(seg) {
  seg.videoStatus = "ready";
  seg.videoUrl = `https://example.com/video_${String(seg.id).padStart(3,"0")}.mp4`;
  seg.thumbnailUrl = `https://picsum.photos/seed/thumb${seg.id}/200/120`;
  seg.duration = 10 + (seg.id % 6);
  seg.resolution = "1080p";
  seg.model = "t2v-beta";
  seg.version = "v1.0";
}

/* ------------------------------
   Scene ë Œë”ë§
------------------------------*/
function renderSceneList() {
  sceneListEl.innerHTML = "";

  segments.forEach(seg => {
    const item = document.createElement("div");
    item.className = "scene-item";

    const thumb = document.createElement("div");
    thumb.className = "thumb";
    thumb.textContent = "â–¶";

    const textBlock = document.createElement("div");
    textBlock.innerHTML = `
      <div style="font-size:13px;">ë¬¸ì¥ ${seg.id}</div>
      <small style="color:#8e94c1;">${seg.lineKo}</small>
    `;

    const promptBlock = document.createElement("div");
    promptBlock.innerHTML = `
      <div style="font-size:11px;color:#8e94c1;">ì˜ë¬¸ í”„ë¡¬í”„íŠ¸</div>
      <div style="font-size:12px;color:#d4d8ff;">${seg.promptEn || "(ë¯¸ìƒì„±)"}</div>
    `;

    const actionBlock = document.createElement("div");

    const pill = document.createElement("span");
    pill.className = "pill " + (seg.videoStatus === "ready" ? "ready" : "pending");
    pill.textContent = seg.videoStatus === "ready" ? "ì™„ë£Œ" : "ëŒ€ê¸°";

    const dlBtn = document.createElement("button");
    dlBtn.className = "btn btn-green";
    dlBtn.style.fontSize = "12px";
    dlBtn.style.padding = "4px 10px";
    dlBtn.textContent = "â¬‡ ë‹¤ìš´ë¡œë“œ";
    dlBtn.disabled = seg.videoStatus !== "ready";
    if (!dlBtn.disabled) dlBtn.onclick = ()=>window.open(seg.videoUrl,"_blank");

    const regenBtn = document.createElement("button");
    regenBtn.className = "btn btn-orange";
    regenBtn.style.fontSize = "12px";
    regenBtn.style.padding = "4px 10px";
    regenBtn.textContent = "ğŸ”„ ì¬ìƒì„±";
    regenBtn.onclick = () => regenerateSingleVideo(seg.id);

    actionBlock.appendChild(pill);
    actionBlock.appendChild(dlBtn);
    actionBlock.appendChild(regenBtn);

    item.appendChild(thumb);
    item.appendChild(textBlock);
    item.appendChild(promptBlock);
    item.appendChild(actionBlock);

    sceneListEl.appendChild(item);
  });
}

renderSceneList();
</script>

</body>
</html>
