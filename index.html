<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¯¸ìŠ¤í„°ë¦¬ ì˜ìƒ ìë™ ìƒì„± MVP (í”„ë¡ íŠ¸ ìŠ¤í…)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0b1020;
      color: #f8f8f8;
    }
    header {
      padding: 12px 16px;
      background: #141a33;
      border-bottom: 1px solid #222a4a;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    header h1 {
      font-size: 18px;
      margin: 0;
      margin-right: 12px;
      white-space: nowrap;
    }
    .spacer {
      flex: 1;
    }
    input, textarea, button {
      font-family: inherit;
      font-size: 14px;
    }
    input[type="text"] {
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid #333c66;
      background: #0f1630;
      color: #f8f8f8;
      min-width: 160px;
    }
    button {
      padding: 6px 10px;
      border-radius: 4px;
      border: 1px solid #3945a5;
      background: #2b3685;
      color: #f8f8f8;
      cursor: pointer;
      transition: background 0.15s, transform 0.05s;
      white-space: nowrap;
    }
    button:hover {
      background: #3c4ac0;
    }
    button:active {
      transform: translateY(1px);
    }
    button.secondary {
      background: #1f253f;
      border-color: #3a425f;
    }
    button.secondary:hover {
      background: #2a3254;
    }
    button.danger {
      background: #742c2c;
      border-color: #a33b3b;
    }
    button.danger:hover {
      background: #9b3636;
    }
    main {
      padding: 16px;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 16px;
    }
    @media (max-width: 960px) {
      main {
        grid-template-columns: 1fr;
      }
    }
    .card {
      background: #11172a;
      border-radius: 8px;
      padding: 12px 14px;
      border: 1px solid #202746;
    }
    .card h2 {
      margin: 0 0 8px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .card h2 span.sub {
      font-size: 12px;
      color: #9ea4c8;
      font-weight: normal;
    }
    .field-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
    }
    textarea {
      width: 100%;
      min-height: 220px;
      resize: vertical;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #333c66;
      background: #060916;
      color: #f8f8f8;
    }
    .label {
      font-size: 13px;
      color: #c0c4e0;
      margin-bottom: 4px;
    }
    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid #394078;
      background: #181f3a;
      color: #c0c6ff;
    }
    .status-pill.ready {
      border-color: #2c8c4a;
      background: #163020;
      color: #b9f3c6;
    }
    .status-pill.generating {
      border-color: #cfa53c;
      background: #352a10;
      color: #ffeaa8;
    }
    .status-pill.none {
      border-color: #555;
      background: #222;
      color: #aaa;
    }
    .scene-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 480px;
      overflow-y: auto;
      padding-right: 4px;
    }
    .scene-row {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #202746;
      background: #090f22;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .scene-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      font-size: 13px;
    }
    .scene-body {
      font-size: 13px;
      color: #d7dbff;
    }
    .scene-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #9ea4c8;
      flex-wrap: wrap;
    }
    .scene-footer a {
      color: #83a4ff;
      text-decoration: none;
    }
    .scene-footer a:hover {
      text-decoration: underline;
    }
    .tag {
      font-size: 11px;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid #34405f;
      color: #a0a6d5;
    }
    .small-hint {
      font-size: 11px;
      color: #888fb8;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ•µï¸ ë¯¸ìŠ¤í„°ë¦¬ ì˜ìƒ ìë™ ìƒì„± (MVP UI)</h1>

    <input id="projectNameInput" type="text" placeholder="í”„ë¡œì íŠ¸ëª… ì…ë ¥" />
    <button id="createProjectBtn">í”„ë¡œì íŠ¸ ìƒì„±</button>
    <button id="projectListBtn" class="secondary">í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸</button>
    <button id="deleteProjectBtn" class="danger">í”„ë¡œì íŠ¸ ì‚­ì œ</button>

    <div class="spacer"></div>
    <span id="currentProjectLabel" class="small-hint">ì„ íƒëœ í”„ë¡œì íŠ¸ ì—†ìŒ</span>
  </header>

  <main>
    <!-- ì™¼ìª½: URL + ìŠ¤í¬ë¦½íŠ¸ -->
    <section class="card">
      <h2>
        1. ì›ë¬¸ ìˆ˜ì§‘ & ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
        <span class="sub">URL â†’ í…ìŠ¤íŠ¸ â†’ 14ë¶„ ìŠ¤í¬ë¦½íŠ¸</span>
      </h2>

      <div class="label">ì‚¬ê±´ ì†ŒìŠ¤ URL (ë‚˜ë¬´ìœ„í‚¤ ë“±)</div>
      <div class="field-row">
        <input id="sourceUrlInput" type="text" placeholder="https://namu.wiki/..." style="flex: 1;" />
        <button id="startBtn">ì‹œì‘í•˜ê¸° (ìŠ¤í¬ë¦½íŠ¸ ìƒì„±)</button>
      </div>
      <div class="small-hint">
        â€» ì§€ê¸ˆì€ í”„ë¡ íŠ¸ ìŠ¤í…ì´ë¼ URLì„ ì‹¤ì œë¡œ í¬ë¡¤ë§í•˜ì§„ ì•Šê³ , ì…ë ¥ê°’ì„ ì´ìš©í•´ ê°€ì§œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“­ë‹ˆë‹¤. ë‚˜ì¤‘ì— ë°±ì—”ë“œì—ì„œ URL â†’ í…ìŠ¤íŠ¸ í¬ë¡¤ë§ + LLM ì—°ê²°.
      </div>

      <hr style="border: none; border-top: 1px solid #202746; margin: 10px 0;" />

      <div class="field-row" style="justify-content: space-between;">
        <div class="label">ìƒì„±ëœ ìŠ¤í¬ë¦½íŠ¸</div>
        <span id="scriptStatusBadge" class="status-pill none">ìŠ¤í¬ë¦½íŠ¸ ìƒíƒœ: ì—†ìŒ</span>
      </div>
      <textarea id="scriptText" placeholder="ì—¬ê¸°ì— ìë™ ìƒì„±ëœ ìŠ¤í¬ë¦½íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤."></textarea>

      <div class="field-row" style="margin-top: 8px; justify-content: flex-end;">
        <button id="saveScriptBtn" class="secondary">ìŠ¤í¬ë¦½íŠ¸ ì €ì¥</button>
        <button id="convertToVideoBtn">ì´ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì˜ìƒ ìƒì„±</button>
      </div>
    </section>

    <!-- ì˜¤ë¥¸ìª½: Scene & ì˜ìƒ ë¦¬ìŠ¤íŠ¸ -->
    <section class="card">
      <h2>
        2. ì¥ë©´ & ì˜ìƒ ìƒíƒœ
        <span class="sub">ë¬¸ì¥ë³„ Scene & ì˜ìƒ URL</span>
      </h2>

      <div class="field-row" style="justify-content: space-between; margin-bottom: 4px;">
        <span class="label">Scene ë¦¬ìŠ¤íŠ¸</span>
        <div style="display:flex; gap:6px; align-items:center;">
          <button id="mockGenerateScenesBtn" class="secondary">ë°ëª¨ìš© Scene ìƒì„±(ê°€ì§œ)</button>
          <button id="downloadAllBtn" class="secondary">ì¼ê´„ ë‹¤ìš´ë¡œë“œ (ê°€ìƒ)</button>
        </div>
      </div>
      <div class="small-hint">
        â€» ì§€ê¸ˆì€ ë°±ì—”ë“œ/APIê°€ ì—†ì–´ì„œ Sceneê³¼ ì˜ìƒ URLì„ ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥í•©ë‹ˆë‹¤.
        ë‚˜ì¤‘ì— FastAPIë¡œ êµì²´í•˜ë©´ ì´ êµ¬ì¡° ê·¸ëŒ€ë¡œ API í˜¸ì¶œë§Œ ë°”ê¾¸ë©´ ë©ë‹ˆë‹¤.
      </div>

      <div id="scenesList" class="scene-list" style="margin-top: 8px;">
        <!-- JSë¡œ Sceneë“¤ ë Œë”ë§ -->
      </div>
    </section>
  </main>

  <script>
    // ===== ê°„ë‹¨í•œ í”„ë¡ íŠ¸ ì „ìš© ìƒíƒœ (MVP í”„ë¡ íŠ¸ ìŠ¤í…) =====
    let projects = []; // { id, name, sourceUrl, scriptText, scriptStatus, videoStatus }
    let scenes = [];   // { id, projectId, order, narrationKo, promptEn, status, videoUrl }
    let currentProjectId = null;
    let projectIdSeq = 1;
    let sceneIdSeq = 1;

    const $ = (id) => document.getElementById(id);

    const projectNameInput = $("projectNameInput");
    const createProjectBtn = $("createProjectBtn");
    const projectListBtn = $("projectListBtn");
    const deleteProjectBtn = $("deleteProjectBtn");
    const currentProjectLabel = $("currentProjectLabel");

    const sourceUrlInput = $("sourceUrlInput");
    const startBtn = $("startBtn");
    const scriptText = $("scriptText");
    const scriptStatusBadge = $("scriptStatusBadge");
    const saveScriptBtn = $("saveScriptBtn");
    const convertToVideoBtn = $("convertToVideoBtn");

    const scenesList = $("scenesList");
    const mockGenerateScenesBtn = $("mockGenerateScenesBtn");
    const downloadAllBtn = $("downloadAllBtn");

    // ===== ìœ í‹¸ =====
    function setScriptStatus(status) {
      scriptStatusBadge.classList.remove("none", "generating", "ready");
      if (status === "none") {
        scriptStatusBadge.textContent = "ìŠ¤í¬ë¦½íŠ¸ ìƒíƒœ: ì—†ìŒ";
        scriptStatusBadge.classList.add("none");
      } else if (status === "generated") {
        scriptStatusBadge.textContent = "ìŠ¤í¬ë¦½íŠ¸ ìƒíƒœ: ìƒì„±ë¨(ë¯¸í™•ì •)";
        scriptStatusBadge.classList.add("generating");
      } else if (status === "confirmed") {
        scriptStatusBadge.textContent = "ìŠ¤í¬ë¦½íŠ¸ ìƒíƒœ: í™•ì •ë¨";
        scriptStatusBadge.classList.add("ready");
      }
    }

    function getCurrentProject() {
      return projects.find(p => p.id === currentProjectId) || null;
    }

    function updateCurrentProjectLabel() {
      const p = getCurrentProject();
      if (!p) {
        currentProjectLabel.textContent = "ì„ íƒëœ í”„ë¡œì íŠ¸ ì—†ìŒ";
      } else {
        currentProjectLabel.textContent = `í˜„ì¬ í”„ë¡œì íŠ¸: ${p.name} (ID: ${p.id})`;
      }
    }

    function renderScenes() {
      const p = getCurrentProject();
      scenesList.innerHTML = "";
      if (!p) {
        const div = document.createElement("div");
        div.className = "small-hint";
        div.textContent = "ë¨¼ì € í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  ì„ íƒí•˜ì„¸ìš”.";
        scenesList.appendChild(div);
        return;
      }

      const projectScenes = scenes
        .filter(s => s.projectId === p.id)
        .sort((a, b) => a.order - b.order);

      if (projectScenes.length === 0) {
        const div = document.createElement("div");
        div.className = "small-hint";
        div.textContent = "ì•„ì§ ìƒì„±ëœ Sceneì´ ì—†ìŠµë‹ˆë‹¤. [ì´ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì˜ìƒ ìƒì„±] ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.";
        scenesList.appendChild(div);
        return;
      }

      for (const s of projectScenes) {
        const row = document.createElement("div");
        row.className = "scene-row";

        const header = document.createElement("div");
        header.className = "scene-header";

        const title = document.createElement("div");
        title.textContent = `Scene ${s.order}`;

        const status = document.createElement("span");
        status.className = "status-pill " + (s.status === "ready" ? "ready" :
                                             s.status === "generating" ? "generating" : "none");
        status.textContent = "ìƒíƒœ: " + s.status;

        header.appendChild(title);
        header.appendChild(status);

        const body = document.createElement("div");
        body.className = "scene-body";
        body.textContent = s.narrationKo;

        const footer = document.createElement("div");
        footer.className = "scene-footer";

        const promptTag = document.createElement("span");
        promptTag.className = "tag";
        promptTag.textContent = "í”„ë¡¬í”„íŠ¸ EN";

        const promptPreview = document.createElement("span");
        promptPreview.textContent = s.promptEn.slice(0, 80) + (s.promptEn.length > 80 ? "..." : "");

        const left = document.createElement("div");
        left.style.display = "flex";
        left.style.alignItems = "center";
        left.style.gap = "6px";
        left.appendChild(promptTag);
        left.appendChild(promptPreview);

        const right = document.createElement("div");
        if (s.videoUrl) {
          const link = document.createElement("a");
          link.href = s.videoUrl;
          link.target = "_blank";
          link.textContent = "ì˜ìƒ ì—´ê¸°";
          right.appendChild(link);
        } else {
          const span = document.createElement("span");
          span.textContent = "ì˜ìƒ URL ì—†ìŒ (ê°€ì§œ ë°ì´í„° ë˜ëŠ” ìƒì„± ì „)";
          right.appendChild(span);
        }

        footer.appendChild(left);
        footer.appendChild(right);

        row.appendChild(header);
        row.appendChild(body);
        row.appendChild(footer);

        scenesList.appendChild(row);
      }
    }

    // ===== ì´ë²¤íŠ¸: í”„ë¡œì íŠ¸ ìƒì„± =====
    createProjectBtn.addEventListener("click", () => {
      const name = projectNameInput.value.trim();
      if (!name) {
        alert("í”„ë¡œì íŠ¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }
      const newProject = {
        id: projectIdSeq++,
        name,
        sourceUrl: "",
        scriptText: "",
        scriptStatus: "none",
        videoStatus: "none",
        createdAt: new Date().toISOString()
      };
      projects.push(newProject);
      currentProjectId = newProject.id;
      projectNameInput.value = "";
      alert(`í”„ë¡œì íŠ¸ ìƒì„±: ${newProject.name} (ID: ${newProject.id})`);
      updateCurrentProjectLabel();
      scriptText.value = "";
      setScriptStatus("none");
      renderScenes();

      // TODO: ë‚˜ì¤‘ì— ì—¬ê¸°ì—ì„œ ë°±ì—”ë“œ POST /projects í˜¸ì¶œë¡œ ë³€ê²½
    });

    // ===== ì´ë²¤íŠ¸: í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ (ê°„ë‹¨ alert) =====
    projectListBtn.addEventListener("click", () => {
      if (projects.length === 0) {
        alert("í”„ë¡œì íŠ¸ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      const listText = projects
        .map(p => `ID: ${p.id}, ì´ë¦„: ${p.name}`)
        .join("\n");
      const chosen = prompt("í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸:\n\n" + listText + "\n\nì„ íƒí•  í”„ë¡œì íŠ¸ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
      if (!chosen) return;
      const id = parseInt(chosen, 10);
      const p = projects.find(p => p.id === id);
      if (!p) {
        alert("í•´ë‹¹ IDì˜ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      currentProjectId = p.id;
      updateCurrentProjectLabel();
      scriptText.value = p.scriptText || "";
      setScriptStatus(p.scriptStatus || "none");
      sourceUrlInput.value = p.sourceUrl || "";
      renderScenes();

      // TODO: ë‚˜ì¤‘ì— GET /projects, GET /projects/{id}ë¡œ ëŒ€ì²´
    });

    // ===== ì´ë²¤íŠ¸: í”„ë¡œì íŠ¸ ì‚­ì œ =====
    deleteProjectBtn.addEventListener("click", () => {
      const p = getCurrentProject();
      if (!p) {
        alert("í˜„ì¬ ì„ íƒëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      if (!confirm(`ì •ë§ë¡œ í”„ë¡œì íŠ¸ "${p.name}" (ID: ${p.id}) ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
      projects = projects.filter(x => x.id !== p.id);
      scenes = scenes.filter(s => s.projectId !== p.id);
      currentProjectId = null;
      updateCurrentProjectLabel();
      scriptText.value = "";
      setScriptStatus("none");
      sourceUrlInput.value = "";
      renderScenes();
      alert("í”„ë¡œì íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");

      // TODO: ë‚˜ì¤‘ì— DELETE /projects/{id}
    });

    // ===== ì´ë²¤íŠ¸: ì‹œì‘í•˜ê¸° (URL â†’ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± - í˜„ì¬ëŠ” ê°€ì§œ) =====
    startBtn.addEventListener("click", () => {
      const p = getCurrentProject();
      if (!p) {
        alert("ë¨¼ì € í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.");
        return;
      }
      const url = sourceUrlInput.value.trim();
      if (!url) {
        alert("URLì„ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }
      // ì§€ê¸ˆì€ ê°€ì§œ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ë¡œì§
      const fakeScript =
        `ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë°ëª¨ìš©ìœ¼ë¡œ ìë™ ìƒì„±ëœ ê°€ì§œ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.\n` +
        `ì†ŒìŠ¤ URL: ${url}\n\n` +
        `1. ì‚¬ê±´ì˜ ë„ì…ë¶€ë¥¼ ì„¤ëª…í•˜ëŠ” ë¬¸ì¥...\n` +
        `2. ì‚¬ê±´ì˜ ë°°ê²½ê³¼ í”¼í•´ìì— ëŒ€í•œ ì„¤ëª…...\n` +
        `3. ì‚¬ê±´ ë‹¹ì¼ì˜ ì •í™© ë¬˜ì‚¬...\n` +
        `4. ìˆ˜ì‚¬ ê³¼ì •ê³¼ ë¯¸ìŠ¤í„°ë¦¬ í¬ì¸íŠ¸...\n` +
        `5. ì•„ì§ í’€ë¦¬ì§€ ì•Šì€ ì˜ë¬¸ê³¼ ì—¬ìš´...\n`;

      p.sourceUrl = url;
      p.scriptText = fakeScript;
      p.scriptStatus = "generated";

      scriptText.value = fakeScript;
      setScriptStatus("generated");

      alert("ê°€ì§œ ìŠ¤í¬ë¦½íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ì´ ë¶€ë¶„ì„ LLM API í˜¸ì¶œë¡œ êµì²´í•©ë‹ˆë‹¤.");

      // TODO: ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œì— POST /projects/{id}/generate_script
    });

    // ===== ì´ë²¤íŠ¸: ìŠ¤í¬ë¦½íŠ¸ ì €ì¥ =====
    saveScriptBtn.addEventListener("click", () => {
      const p = getCurrentProject();
      if (!p) {
        alert("ë¨¼ì € í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
        return;
      }
      const text = scriptText.value.trim();
      if (!text) {
        if (!confirm("ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      }
      p.scriptText = text;
      p.scriptStatus = "confirmed";
      setScriptStatus("confirmed");
      alert("ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ ë²„ì „ìœ¼ë¡œ í™•ì •í–ˆìŠµë‹ˆë‹¤.");

      // TODO: ì‹¤ì œë¡œëŠ” POST /projects/{id}/confirm_script
    });

    // ===== ì´ë²¤íŠ¸: ì˜ìƒ ìƒì„± (ìŠ¤í¬ë¦½íŠ¸ â†’ Scene ë¶„í•  + í”„ë¡¬í”„íŠ¸ + T2V) í˜„ì¬ëŠ” ê°€ì§œ Scene ìƒì„± =====
    convertToVideoBtn.addEventListener("click", () => {
      const p = getCurrentProject();
      if (!p) {
        alert("ë¨¼ì € í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
        return;
      }
      if (!p.scriptText) {
        alert("ìŠ¤í¬ë¦½íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±/ì €ì¥í•˜ì„¸ìš”.");
        return;
      }

      // ì§€ê¸ˆì€ ì•„ì£¼ ë‹¨ìˆœí•˜ê²Œ ì¤„ ë‹¨ìœ„ë¡œ ë‚˜ëˆ ì„œ Scene ìƒì„± (ê°€ì§œ)
      const lines = p.scriptText.split("\n").map(l => l.trim()).filter(l => l.length > 0);
      const newScenes = [];
      let order = 1;
      for (const line of lines) {
        const s = {
          id: sceneIdSeq++,
          projectId: p.id,
          order: order++,
          narrationKo: line,
          promptEn: `Cinematic scene for: "${line.slice(0, 30)}..." in a dark, mysterious documentary style. [Tracking shot]`,
          status: "ready", // ì‹¤ì œë¡  pending â†’ generating â†’ ready
          videoUrl: `https://example.com/fake_video_${p.id}_${order - 1}.mp4`
        };
        newScenes.push(s);
      }

      // ê¸°ì¡´ Sceneì€ ì‹¹ ì§€ìš°ê³  ìƒˆë¡œ ìƒì„± (MVP ê°„ë‹¨í™”)
      scenes = scenes.filter(s => s.projectId !== p.id).concat(newScenes);
      renderScenes();
      alert("ê°€ì§œ Sceneê³¼ ì˜ìƒ URLë“¤ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ì´ ë¶€ë¶„ì„ LLM + Minimax T2V API í˜¸ì¶œë¡œ êµì²´í•©ë‹ˆë‹¤.");

      // TODO:
      // 1) ë°±ì—”ë“œ POST /projects/{id}/generate_scenes_and_videos
      // 2) ë°±ì—”ë“œì—ì„œ LLMìœ¼ë¡œ scene ë¶„í•  + prompt ìƒì„±
      // 3) Minimax /video_generation, /query... í˜¸ì¶œ í›„ ì‹¤ì œ videoUrl ì €ì¥
      // 4) í”„ë¡ íŠ¸ëŠ” GET /projects/{id}/scenes ë¡œ ì£¼ê¸°ì  ì¡°íšŒ
    });

    // ===== ë°ëª¨ìš© Scene ìƒì„± ë²„íŠ¼ (í˜„ì¬ í”„ë¡œì íŠ¸ì— ì„ì˜ Scene ì¶”ê°€) =====
    mockGenerateScenesBtn.addEventListener("click", () => {
      const p = getCurrentProject();
      if (!p) {
        alert("ë¨¼ì € í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
        return;
      }
      const baseOrder = scenes.filter(s => s.projectId === p.id).length + 1;
      const s1 = {
        id: sceneIdSeq++,
        projectId: p.id,
        order: baseOrder,
        narrationKo: "1989ë…„ 3ì›” 7ì¼, ì¼ë³¸ ì‹œì½”ì¿ ì˜ ì‘ì€ ë§ˆì„ì—ì„œ í•œ ì•„ì´ê°€ ì‚¬ë¼ì¡Œë‹¤.",
        promptEn: "A quiet Japanese rural town at dusk, empty streets and dim street lamps. [Slow pan]",
        status: "ready",
        videoUrl: "https://example.com/demo_scene1.mp4"
      };
      const s2 = {
        id: sceneIdSeq++,
        projectId: p.id,
        order: baseOrder + 1,
        narrationKo: "ì•„ì´ì˜ ì•„ë²„ì§€ëŠ” ì ì‹œ ì§‘ ì•ˆì— ë“¤ì–´ê°”ë‹¤ ë‚˜ì˜¨ ì‚¬ì´, ë„¤ ì‚´ë°°ê¸° ì•„ë“¤ì´ ì‚¬ë¼ì§„ ê²ƒì„ ê¹¨ë‹«ëŠ”ë‹¤.",
        promptEn: "A worried father rushing out of a small wooden house, looking around frantically. [Handheld shot]",
        status: "ready",
        videoUrl: "https://example.com/demo_scene2.mp4"
      };
      scenes.push(s1, s2);
      renderScenes();
      alert("ë°ëª¨ìš© Scene 2ê°œë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.");
    });

    // ===== ì¼ê´„ ë‹¤ìš´ë¡œë“œ (ì§€ê¸ˆì€ ê·¸ëƒ¥ URL ëª©ë¡ alert) =====
    downloadAllBtn.addEventListener("click", () => {
      const p = getCurrentProject();
      if (!p) {
        alert("ë¨¼ì € í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
        return;
      }
      const projectScenes = scenes
        .filter(s => s.projectId === p.id)
        .sort((a, b) => a.order - b.order);

      if (projectScenes.length === 0) {
        alert("ë‹¤ìš´ë¡œë“œí•  Sceneì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      const urls = projectScenes
        .map(s => `Scene ${s.order}: ${s.videoUrl || "(URL ì—†ìŒ)"}`)
        .join("\n");

      alert("MVP ìŠ¤í…: ì¼ê´„ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì€ ë‚˜ì¤‘ì— êµ¬í˜„.\n\ní˜„ì¬ Sceneë³„ ì˜ìƒ URL ëª©ë¡:\n\n" + urls);

      // TODO: ì‹¤ì œ êµ¬í˜„
      // 1) ë°±ì—”ë“œ GET /projects/{id}/download_zip â†’ ZIP íŒŒì¼ ë‹¤ìš´ë¡œë“œ
      // 2) ì´ ë²„íŠ¼ì—ì„œ í•´ë‹¹ ZIP ë§í¬ë¡œ ì´ë™
    });

    // ì´ˆê¸° ë Œë”
    updateCurrentProjectLabel();
    setScriptStatus("none");
    renderScenes();
  </script>
</body>
</html>

