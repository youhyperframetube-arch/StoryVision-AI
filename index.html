<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>StoryVision AI - ë¯¸ìŠ¤í„°ë¦¬ ì˜ìƒ ìë™ í”„ë¡¬í”„íŠ¸ & ìƒì„± ê´€ë¦¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;      
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050815;
      color: #f5f5ff;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    header {
      padding: 16px 20px;
      background: linear-gradient(90deg, #0c1024, #151b3a);
      border-bottom: 1px solid #232a4c;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 8px;
    }

    header .title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    header h1 {
      font-size: 20px;
      margin: 0;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    header .subtitle {
      font-size: 12px;
      color: #a6a9d4;
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 32px;
    }

    section {
      padding: 24px 20px 32px;
    }

    .stripe-1 {
      background: radial-gradient(circle at top left, #181f3f 0, #050815 55%);
      border-bottom: 1px solid #1c2342;
    }

    .stripe-2 {
      background: radial-gradient(circle at top right, #151f3c 0, #050815 70%);
      border-top: 1px solid #11162f;
    }

    .section-inner {
      max-width: 960px;
      margin: 0 auto;
    }

    .section-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 16px;
    }

    .section-title {
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title span.badge {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #252c55;
      border: 1px solid #3a4584;
      color: #c7d1ff;
    }

    .section-desc {
      font-size: 13px;
      color: #a8add6;
    }

    textarea {
      width: 100%;
      min-height: 220px;
      resize: vertical;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #313a69;
      background: #070a18;
      color: #f5f5ff;
      font-family: inherit;
      font-size: 14px;
      line-height: 1.5;
    }

    textarea::placeholder {
      color: #696f9c;
    }

    .label {
      font-size: 13px;
      color: #c4c7ec;
      margin-bottom: 6px;
    }

    .helper {
      font-size: 11px;
      color: #868bbb;
      margin-top: 4px;
    }

    .btn {
      font-family: inherit;
      font-size: 14px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid #3943a6;
      background: #2a3389;
      color: #f5f5ff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s, transform 0.05s, opacity 0.15s;
      white-space: nowrap;
    }

    .btn span.icon {
      font-size: 15px;
    }

    .btn:hover:not(:disabled) {
      background: #3c47c0;
    }

    .btn:active:not(:disabled) {
      transform: translateY(1px);
    }

    .btn:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #161a34;
      border-color: #3a405f;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #202640;
    }

    .btn-green {
      background: #1f6f46;
      border-color: #28a567;
    }

    .btn-green:hover:not(:disabled) {
      background: #2a9a63;
    }

    .btn-grey {
      background: #272b3c;
      border-color: #3e4256;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-top: 12px;
    }

    .progress-wrapper {
      margin-top: 16px;
    }

    .progress-label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #9aa1d4;
      margin-bottom: 4px;
    }

    .progress-bar-outer {
      position: relative;
      width: 100%;
      height: 14px;
      border-radius: 999px;
      background: #15182b;
      overflow: hidden;
      border: 1px solid #272d4f;
    }

    .progress-bar-inner {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #b32b39, #f55c4a);
      transition: width 0.1s linear, background 0.2s;
    }

    .progress-bar-inner.done {
      background: linear-gradient(90deg, #2e9f5d, #5be48f);
    }

    .progress-percentage {
      font-size: 11px;
      color: #d1d7ff;
      margin-top: 4px;
      text-align: right;
    }

    .hidden {
      display: none;
    }

    .card {
      border-radius: 10px;
      border: 1px solid #252c4c;
      background: rgba(7, 10, 25, 0.9);
      padding: 14px 16px;
      margin-top: 8px;
    }

    .scene-list {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 420px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .scene-item {
      display: grid;
      grid-template-columns: 72px minmax(0, 1.6fr) minmax(0, 1.3fr) auto;
      gap: 10px;
      padding: 8px;
      border-radius: 8px;
      background: #090d22;
      border: 1px solid #252c4c;
      align-items: center;
    }

    @media (max-width: 900px) {
      .scene-item {
        grid-template-columns: 72px minmax(0, 1fr);
        grid-template-rows: auto auto auto;
      }
      .scene-item > .scene-prompt {
        grid-column: 1 / span 2;
      }
      .scene-item > .scene-actions {
        grid-column: 1 / span 2;
      }
    }

    .thumb {
      width: 72px;
      height: 48px;
      border-radius: 6px;
      background: radial-gradient(circle at 20% 20%, #ffffff33 0, #38408a 25%, #14162f 55%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: #dde2ff;
      position: relative;
      overflow: hidden;
    }

    .thumb::after {
      content: "";
      position: absolute;
      width: 85%;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, #ffffff55, transparent);
      transform: rotate(-28deg);
      top: 10%;
      left: -30%;
    }

    .scene-text {
      font-size: 13px;
      color: #e3e6ff;
    }

    .scene-text small {
      display: block;
      font-size: 11px;
      color: #8e94c1;
      margin-top: 3px;
    }

    .scene-prompt {
      font-size: 12px;
      color: #b8bff3;
    }

    .scene-prompt-label {
      font-size: 11px;
      color: #8e94c1;
      margin-bottom: 2px;
    }

    .scene-prompt-content {
      font-size: 12px;
      color: #d4d8ff;
    }

    .scene-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      font-size: 11px;
      color: #9aa1d4;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #38406b;
      background: #10152d;
      font-size: 11px;
      color: #c0c6ff;
    }

    .pill.ready {
      border-color: #2c8f57;
      background: #14291f;
      color: #bfeecf;
    }

    .pill.pending {
      border-color: #91502e;
      background: #26150f;
      color: #ffd7b3;
    }

    footer {
      padding: 12px 20px 20px;
      border-top: 1px solid #101632;
      font-size: 11px;
      color: #7f85b4;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <div class="title">
      <h1>StoryVision AI</h1>
      <div class="subtitle">ê¸°ë¬˜í•œ ë°¤ ìŠ¤íƒ€ì¼ ë¯¸ìŠ¤í„°ë¦¬ ì˜ìƒí™”ë¥¼ ìœ„í•œ í…ìŠ¤íŠ¸ â†’ í”„ë¡¬í”„íŠ¸ â†’ ì˜ìƒ ìƒì„± ë„ìš°ë¯¸ (MVP)</div>
    </div>
  </header>

  <main>
    <!-- ìŠ¤íŠ¸ë© 1: í”„ë¡¬í”„íŠ¸ ìƒì„± -->
    <section class="stripe-1">
      <div class="section-inner">
        <div class="section-header">
          <div class="section-title">
            <span>ìŠ¤íŠ¸ë© 1 Â· í”„ë¡¬í”„íŠ¸ ìƒì„±</span>
            <span class="badge">STEP 1</span>
          </div>
          <div class="section-desc">
            ë¨¼ì € ì˜ìƒí™”í•˜ê³  ì‹¶ì€ ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì•„ë˜ì— ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.<br />
            ì´ ë„êµ¬ëŠ” <strong>ê° ì¤„(ì¤„ë°”ê¿ˆ ë‹¨ìœ„)ë§ˆë‹¤ 1ê°œì˜ ì˜ìƒ</strong>ì„ ë§Œë“ ë‹¤ê³  ê°€ì •í•˜ê³ ,
            ë¬¸ì¥ë³„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” <strong>ì˜ë¬¸ í”„ë¡¬í”„íŠ¸</strong>ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
          </div>
        </div>

        <div class="card">
          <div class="label">ì˜ìƒí™”í•˜ê³  ì‹¶ì€ ì „ì²´ ë¬¸ì¥ì„ ë„£ì–´ì£¼ì„¸ìš”.</div>
          <textarea id="inputText" placeholder="ì˜ˆì‹œ)&#10;ì•„ì´ê°€ ì‚¬ë¼ì§€ëŠ” ë° ê±¸ë¦° ì‹œê°„, ë‹¨ 20ì´ˆ.&#10;ì•„ë²„ì§€ê°€ ì§‘ ì•ˆì— ë“¤ì–´ê°€ ë‘˜ì§¸ ì•„ì´ë¥¼ ê±´ë„¤ì£¼ê³  ë‹¤ì‹œ í˜„ê´€ìœ¼ë¡œ ë‚˜ì˜¨ ìˆœê°„,&#10;ë„¤ ì‚´ë°°ê¸° ì•„ë“¤ì€ ì„¸ìƒì—ì„œ ê°ìª½ê°™ì´ ì‚¬ë¼ì ¸ë²„ë ¸ìŠµë‹ˆë‹¤."></textarea>
          <div class="helper">
            - ì¤„ë°”ê¿ˆ(Enter) ê¸°ì¤€ìœ¼ë¡œ í•œ ì¤„ = í•œ ì˜ìƒ í´ë¦½ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.<br />
            - ìŠ¤í¬ë¦½íŠ¸ëŠ” GPTì—ì„œ ë”°ë¡œ ì‘ì„±í•œ ë’¤ ì´ê³³ì— ë¶™ì—¬ë„£ëŠ”ë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
          </div>

          <div class="row">
            <button id="generatePromptsBtn" class="btn">
              <span class="icon">âœ¨</span>
              í”„ë¡¬í”„íŠ¸ ìƒì„±í•˜ê¸°
            </button>
            <span class="helper">â€» ë²„íŠ¼ í´ë¦­ ì‹œ ë¹„ë°€ë²ˆí˜¸(9981)ë¥¼ ì…ë ¥í•´ì•¼ ì‹¤í–‰ë©ë‹ˆë‹¤.</span>
          </div>

          <div id="promptProgressWrapper" class="progress-wrapper hidden">
            <div class="progress-label-row">
              <span>í”„ë¡¬í”„íŠ¸ ìƒì„± ì§„í–‰ë„</span>
              <span id="promptStatusText">ëŒ€ê¸° ì¤‘â€¦</span>
            </div>
            <div class="progress-bar-outer">
              <div id="promptProgressBar" class="progress-bar-inner"></div>
            </div>
            <div id="promptProgressPercent" class="progress-percentage">0%</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ìŠ¤íŠ¸ë© 2: ì˜ìƒ ìƒì„± -->
    <section class="stripe-2">
      <div class="section-inner">
        <div class="section-header">
          <div class="section-title">
            <span>ìŠ¤íŠ¸ë© 2 Â· ì˜ìƒ ìƒì„± ê´€ë¦¬</span>
            <span class="badge">STEP 2</span>
          </div>
          <div class="section-desc">
            ìŠ¤íŠ¸ë© 1ì—ì„œ ìƒì„±ëœ ë¬¸ì¥ + ì˜ë¬¸ í”„ë¡¬í”„íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ê° ë¬¸ì¥ë§ˆë‹¤ 1ê°œì˜ ì˜ìƒì„ ë§Œë“œëŠ” ê³¼ì •ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.<br />
            ì´í›„ ì‹¤ì œ Minimax T2V APIì™€ ì—°ê²°í•˜ë©´, ì´ UI ê·¸ëŒ€ë¡œ ë¬¸ì¥ë³„ ì˜ìƒ ìƒì„± ìƒíƒœë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </div>
        </div>

        <div class="card">
          <div class="row" style="justify-content: space-between; align-items: center;">
            <div class="helper">
              - ë¨¼ì € ìŠ¤íŠ¸ë© 1ì—ì„œ í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•œ ë’¤ ì‚¬ìš©í•˜ì„¸ìš”.<br />
              - ê° ë¬¸ì¥/í”„ë¡¬í”„íŠ¸ì— ëŒ€í•´ 1ê°œì˜ ì˜ìƒì´ ìƒì„±ëœë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
            </div>
            <button id="generateVideosBtn" class="btn btn-secondary">
              <span class="icon">ğŸ¬</span>
              ì˜ìƒ ìƒì„±í•˜ê¸°
            </button>
          </div>

          <div id="videoProgressWrapper" class="progress-wrapper hidden">
            <div class="progress-label-row">
              <span>ì˜ìƒ ìƒì„± ì§„í–‰ë„</span>
              <span id="videoStatusText">ëŒ€ê¸° ì¤‘â€¦</span>
            </div>
            <div class="progress-bar-outer">
              <div id="videoProgressBar" class="progress-bar-inner"></div>
            </div>
            <div id="videoProgressPercent" class="progress-percentage">0%</div>
          </div>

          <div class="row" style="justify-content: flex-end; margin-top: 16px;">
            <button id="downloadAllBtn" class="btn btn-grey" disabled>
              <span class="icon">ğŸ“¦</span>
              ì¼ê´„ ë‹¤ìš´ë¡œë“œ (ëª¨ë“  ì˜ìƒ ì™„ë£Œ ì‹œ í™œì„±í™”)
            </button>
          </div>

          <div id="sceneList" class="scene-list">
            <!-- JSë¡œ ì¥ë©´ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ -->
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    StoryVision AI Â· í”„ë¡ íŠ¸ì—”ë“œ MVP Â· ì‹¤ì œ GPT / Minimax ì—°ë™ì€ ì¶”í›„ ë°±ì—”ë“œì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤.
  </footer>

  <script>
    //server add
    const API_BASE = "https://storyvision-backend.onrender.com";

    // ===== ì „ì—­ ìƒíƒœ (ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬) =====
    let segments = []; // { id, lineKo, promptEn, videoStatus, videoUrl }
    let promptGenerationInProgress = false;
    let videoGenerationInProgress = false;

    const PASSWORD = "9981";

    // ===== DOM í—¬í¼ =====
    const $ = (id) => document.getElementById(id);

    const inputTextEl = $("inputText");
    const generatePromptsBtn = $("generatePromptsBtn");
    const promptProgressWrapper = $("promptProgressWrapper");
    const promptProgressBar = $("promptProgressBar");
    const promptProgressPercent = $("promptProgressPercent");
    const promptStatusText = $("promptStatusText");

    const generateVideosBtn = $("generateVideosBtn");
    const videoProgressWrapper = $("videoProgressWrapper");
    const videoProgressBar = $("videoProgressBar");
    const videoProgressPercent = $("videoProgressPercent");
    const videoStatusText = $("videoStatusText");
    const downloadAllBtn = $("downloadAllBtn");
    const sceneListEl = $("sceneList");

    // ===== ê³µí†µ: ë¹„ë°€ë²ˆí˜¸ í™•ì¸ =====
    function checkPassword() {
      const answer = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (íŒíŠ¸: 9981)");
      if (answer === null) return false;
      if (answer.trim() !== PASSWORD) {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return false;
      }
      return true;
    }

    // ì„œë²„ í˜¸ì¶œ í•¨ìˆ˜
    function callGeneratePromptsAPI(lines) {
  promptStatusText.textContent = "ì„œë²„ì— ìš”ì²­ ì¤‘â€¦";

  fetch(`${API_BASE}/generate-prompts`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({ lines }),
  })
    .then(res => res.json())
    .then(data => {
      data.items.forEach(item => {
        const seg = segments.find(s => s.id === item.id);
        if (seg) {
          seg.promptEn = item.prompt_en;
        }
      });

      renderSceneList();
      promptStatusText.textContent = "í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ!";
    })
    .catch(err => {
      alert("ì„œë²„ ì˜¤ë¥˜: " + err.message);
    });
}


    // ===== í”„ë¡¬í”„íŠ¸ ìƒì„± (ìŠ¤íŠ¸ë© 1) =====
    generatePromptsBtn.addEventListener("click", () => {
  if (!checkPassword()) return;

  const raw = inputTextEl.value;
  const lines = raw.split("\n").map(l => l.trim()).filter(l => l.length > 0);
  if (lines.length === 0) {
    alert("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  // ì´ˆê¸°í™”
  segments = lines.map((line, idx) => ({
    id: idx + 1,
    lineKo: line,
    promptEn: "",
    videoStatus: "pending",
    videoUrl: null,
  }));

  renderSceneList();
  callGeneratePromptsAPI(lines);
});


      if (!checkPassword()) return;

      const raw = inputTextEl.value;
      const lines = raw.split("\n").map(l => l.trim()).filter(l => l.length > 0);

      if (lines.length === 0) {
        alert("ë¨¼ì € ì˜ìƒí™”í•˜ê³  ì‹¶ì€ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì¤„ë°”ê¿ˆ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬ë©ë‹ˆë‹¤)");
        return;
      }

      // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”
      segments = [];
      for (let i = 0; i < lines.length; i++) {
        segments.push({
          id: i + 1,
          lineKo: lines[i],
          promptEn: "",
          videoStatus: "pending", // "pending" | "ready"
          videoUrl: null,
        });
      }

      renderSceneList(); // ì•„ì§ promptëŠ” ë¹„ì–´ìˆì§€ë§Œ ë¦¬ìŠ¤íŠ¸ë¶€í„° ê·¸ë¦¼
      startPromptGenerationSimulation(lines);
    });

    function startPromptGenerationSimulation(lines) {
      promptGenerationInProgress = true;
      generatePromptsBtn.disabled = true;
      generateVideosBtn.disabled = true;
      downloadAllBtn.disabled = true;

      promptProgressWrapper.classList.remove("hidden");
      promptProgressBar.classList.remove("done");
      promptProgressBar.style.width = "0%";
      promptProgressPercent.textContent = "0%";
      promptStatusText.textContent = `í”„ë¡¬í”„íŠ¸ ìƒì„± ì¤€ë¹„ ì¤‘â€¦ (0 / ${lines.length})`;

      let current = 0;
      const total = lines.length;
      const baseDelay = 150; // í•œ ì¤„ë‹¹ 0.15ì´ˆ ì •ë„ë¡œ ì‹œë®¬ë ˆì´ì…˜

      function step() {
        if (current >= total) {
          // ì™„ë£Œ
          promptGenerationInProgress = false;
          promptProgressBar.classList.add("done");
          promptProgressBar.style.width = "100%";
          promptProgressPercent.textContent = "100%";
          promptStatusText.textContent = `í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ! (${total}ê°œ)`;

          generatePromptsBtn.disabled = false;
          generateVideosBtn.disabled = false;
          renderSceneList();
          return;
        }

        // "GPTë¡œ í”„ë¡¬í”„íŠ¸ ìƒì„±" ì‹œë®¬ë ˆì´ì…˜
        const line = lines[current];
        const englishPrompt =
          `Cinematic documentary shot for: "${line.slice(0, 40)}..." in a dark, mysterious tone, subtle camera movement, gloomy atmosphere.`;

        segments[current].promptEn = englishPrompt;

        current++;
        const progress = Math.round((current / total) * 100);
        promptProgressBar.style.width = progress + "%";
        promptProgressPercent.textContent = progress + "%";
        promptStatusText.textContent = `í”„ë¡¬í”„íŠ¸ ìƒì„± ì¤‘â€¦ (${current} / ${total})`;

        renderSceneList();

        setTimeout(step, baseDelay);
      }

      setTimeout(step, 200);
    }

    // ===== ì˜ìƒ ìƒì„± (ìŠ¤íŠ¸ë© 2) =====
    generateVideosBtn.addEventListener("click", () => {
      if (videoGenerationInProgress || promptGenerationInProgress) {
        alert("í˜„ì¬ ë‹¤ë¥¸ ì‘ì—…ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.");
        return;
      }

      if (!checkPassword()) return;

      if (segments.length === 0) {
        alert("ë¨¼ì € ìŠ¤íŠ¸ë© 1ì—ì„œ í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.");
        return;
      }

      const missingPrompt = segments.some(s => !s.promptEn || s.promptEn.trim() === "");
      if (missingPrompt) {
        alert("í”„ë¡¬í”„íŠ¸ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì€ ë¬¸ì¥ì´ ìˆìŠµë‹ˆë‹¤. ìŠ¤íŠ¸ë© 1 ì‘ì—…ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.");
        return;
      }

      startVideoGenerationSimulation();
    });

    function startVideoGenerationSimulation() {
      videoGenerationInProgress = true;
      generateVideosBtn.disabled = true;
      generatePromptsBtn.disabled = true;
      downloadAllBtn.disabled = true;

      videoProgressWrapper.classList.remove("hidden");
      videoProgressBar.classList.remove("done");
      videoProgressBar.style.width = "0%";
      videoProgressPercent.textContent = "0%";

      const total = segments.length;
      let current = 0;

      videoStatusText.textContent = `ì˜ìƒ ìƒì„± ì¤€ë¹„ ì¤‘â€¦ (0 / ${total})`;

      const baseDelay = 450; // í•œ í¸ë‹¹ 0.45ì´ˆ ì •ë„ë¡œ ì‹œë®¬ë ˆì´ì…˜

      function step() {
        if (current >= total) {
          // ì™„ë£Œ
          videoGenerationInProgress = false;
          videoProgressBar.classList.add("done");
          videoProgressBar.style.width = "100%";
          videoProgressPercent.textContent = "100%";
          videoStatusText.textContent = `ì˜ìƒ ìƒì„± ì™„ë£Œ! (${total}ê°œ)`;

          generateVideosBtn.disabled = false;
          generatePromptsBtn.disabled = false;
          downloadAllBtn.disabled = false; // ì „ì²´ ì™„ë£Œ ì‹œ í™œì„±í™”
          return;
        }

        // "Minimax T2V ì˜ìƒ ìƒì„±" ì‹œë®¬ë ˆì´ì…˜
        const seg = segments[current];
        seg.videoStatus = "ready";
        seg.videoUrl = `https://example.com/video_${String(seg.id).padStart(3, "0")}.mp4`;

        current++;
        const progress = Math.round((current / total) * 100);
        videoProgressBar.style.width = progress + "%";
        videoProgressPercent.textContent = progress + "%";
        videoStatusText.textContent = `ì˜ìƒ ìƒì„± ì¤‘â€¦ (${current} / ${total})`;

        renderSceneList();

        setTimeout(step, baseDelay);
      }

      setTimeout(step, 300);
    }

    // ===== Scene ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ =====
    function renderSceneList() {
      sceneListEl.innerHTML = "";

      if (segments.length === 0) {
        const div = document.createElement("div");
        div.className = "helper";
        div.textContent = "ì•„ì§ ë¬¸ì¥/í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ìŠ¤íŠ¸ë© 1ì—ì„œ ë¨¼ì € í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.";
        sceneListEl.appendChild(div);
        return;
      }

      for (const seg of segments) {
        const item = document.createElement("div");
        item.className = "scene-item";

        // ì¸ë„¤ì¼
        const thumb = document.createElement("div");
        thumb.className = "thumb";
        thumb.textContent = "â–¶";

        // ë¬¸ì¥
        const textBlock = document.createElement("div");
        textBlock.className = "scene-text";
        const lineTitle = document.createElement("div");
        lineTitle.textContent = `ë¬¸ì¥ ${seg.id}`;
        const lineContent = document.createElement("small");
        lineContent.textContent = seg.lineKo;
        textBlock.appendChild(lineTitle);
        textBlock.appendChild(lineContent);

        // í”„ë¡¬í”„íŠ¸
        const promptBlock = document.createElement("div");
        promptBlock.className = "scene-prompt";
        const promptLabel = document.createElement("div");
        promptLabel.className = "scene-prompt-label";
        promptLabel.textContent = "ì˜ë¬¸ í”„ë¡¬í”„íŠ¸";
        const promptContent = document.createElement("div");
        promptContent.className = "scene-prompt-content";
        promptContent.textContent = seg.promptEn || "(ì•„ì§ í”„ë¡¬í”„íŠ¸ ë¯¸ìƒì„±)";
        promptBlock.appendChild(promptLabel);
        promptBlock.appendChild(promptContent);

        // ì•¡ì…˜/ìƒíƒœ
        const actionBlock = document.createElement("div");
        actionBlock.className = "scene-actions";

        const statusPill = document.createElement("span");
        statusPill.className = "pill " + (seg.videoStatus === "ready" ? "ready" : "pending");
        statusPill.textContent =
          seg.videoStatus === "ready" ? "ì˜ìƒ ìƒì„± ì™„ë£Œ" : "ì˜ìƒ ìƒì„± ëŒ€ê¸°";

        const downloadBtn = document.createElement("button");
        downloadBtn.className = "btn " + (seg.videoStatus === "ready" ? "btn-green" : "btn-grey");
        downloadBtn.style.padding = "5px 10px";
        downloadBtn.style.fontSize = "12px";
        downloadBtn.innerHTML = '<span class="icon">â¬‡</span>ë‹¤ìš´ë¡œë“œ';

        if (seg.videoStatus === "ready" && seg.videoUrl) {
          downloadBtn.disabled = false;
          downloadBtn.addEventListener("click", () => {
            // ì‹¤ì œë¡œëŠ” seg.videoUrlë¡œ ì´ë™/ë‹¤ìš´ë¡œë“œ
            window.open(seg.videoUrl, "_blank");
          });
        } else {
          downloadBtn.disabled = true;
        }

        actionBlock.appendChild(statusPill);
        actionBlock.appendChild(downloadBtn);

        item.appendChild(thumb);
        item.appendChild(textBlock);
        item.appendChild(promptBlock);
        item.appendChild(actionBlock);

        sceneListEl.appendChild(item);
      }
    }

    // ===== ì¼ê´„ ë‹¤ìš´ë¡œë“œ (MVP: URL ë¦¬ìŠ¤íŠ¸ ì¶œë ¥) =====
    downloadAllBtn.addEventListener("click", () => {
      if (segments.length === 0) {
        alert("ë‹¤ìš´ë¡œë“œí•  ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      const incomplete = segments.some(s => s.videoStatus !== "ready" || !s.videoUrl);
      if (incomplete) {
        alert("ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì€ ì˜ìƒì´ ìˆìŠµë‹ˆë‹¤.");
        return;
      }

      const urls = segments
        .map(s => `ë¬¸ì¥ ${s.id}: ${s.videoUrl}`)
        .join("\n");

      // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ZIP ìƒì„±/ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ ì‚¬ìš©í•  ê²ƒ.
      alert("MVP ìŠ¤í…: ì•„ë˜ URLë“¤ì„ ì´ìš©í•´ ì˜ìƒ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n" + urls);
    });

    // ì´ˆê¸° ë Œë”
    renderSceneList();
  </script>
</body>
</html>
